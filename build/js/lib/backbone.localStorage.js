!function(e,t){"object"==typeof exports&&"function"==typeof require?module.exports=t(require("backbone")):"function"==typeof define&&define.amd?define(["backbone"],function(r){return t(r||e.Backbone)}):t(Backbone)}(this,function(e){function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function r(){return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}function i(e){return e===Object(e)}function o(e,t){for(var r=e.length;r--;)if(e[r]===t)return!0;return!1}function n(e,t){for(var r in t)e[r]=t[r];return e}function a(e,t){if(null==e)return void 0;var r=e[t];return"function"==typeof r?e[t]():r}return e.LocalStorage=window.Store=function(e,t){if(!this.localStorage)throw"Backbone.localStorage: Environment does not support localStorage.";this.name=e,this.serializer=t||{serialize:function(e){return i(e)?JSON.stringify(e):e},deserialize:function(e){return e&&JSON.parse(e)}};var r=this.localStorage().getItem(this.name);this.records=r&&r.split(",")||[]},n(e.LocalStorage.prototype,{save:function(){this.localStorage().setItem(this.name,this.records.join(","))},create:function(e){return e.id||0===e.id||(e.id=r(),e.set(e.idAttribute,e.id)),this.localStorage().setItem(this._itemName(e.id),this.serializer.serialize(e)),this.records.push(e.id.toString()),this.save(),this.find(e)},update:function(e){this.localStorage().setItem(this._itemName(e.id),this.serializer.serialize(e));var t=e.id.toString();return o(this.records,t)||(this.records.push(t),this.save()),this.find(e)},find:function(e){return this.serializer.deserialize(this.localStorage().getItem(this._itemName(e.id)))},findAll:function(){for(var e,t,r=[],i=0;i<this.records.length;i++)e=this.records[i],t=this.serializer.deserialize(this.localStorage().getItem(this._itemName(e))),null!=t&&r.push(t);return r},destroy:function(e){this.localStorage().removeItem(this._itemName(e.id));for(var t=e.id.toString(),r=0;r<this.records.length;r++)this.records[r]===t&&this.records.splice(r,1);return this.save(),e},localStorage:function(){return localStorage},_clear:function(){var e=this.localStorage(),t=new RegExp("^"+this.name+"-");e.removeItem(this.name);for(var r in e)t.test(r)&&e.removeItem(r);this.records.length=0},_storageSize:function(){return this.localStorage().length},_itemName:function(e){return this.name+"-"+e}}),e.LocalStorage.sync=window.Store.sync=e.localSync=function(t,r,i){var o,n,s=a(r,"localStorage")||a(r.collection,"localStorage"),c=e.$?e.$.Deferred&&e.$.Deferred():e.Deferred&&e.Deferred();try{switch(t){case"read":o=void 0!=r.id?s.find(r):s.findAll();break;case"create":o=s.create(r);break;case"update":o=s.update(r);break;case"delete":o=s.destroy(r)}}catch(l){n=22===l.code&&0===s._storageSize()?"Private browsing is unsupported":l.message}return o?(i&&i.success&&("0.9.10"===e.VERSION?i.success(r,o,i):i.success(o)),c&&c.resolve(o)):(n=n?n:"Record Not Found",i&&i.error&&("0.9.10"===e.VERSION?i.error(r,n,i):i.error(n)),c&&c.reject(n)),i&&i.complete&&i.complete(o),c&&c.promise()},e.ajaxSync=e.sync,e.getSyncMethod=function(t,r){var i=r&&r.ajaxSync;return i||!a(t,"localStorage")&&!a(t.collection,"localStorage")?e.ajaxSync:e.localSync},e.sync=function(t,r,i){return e.getSyncMethod(r,i).apply(this,[t,r,i])},e.LocalStorage});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9iYWNrYm9uZS5sb2NhbFN0b3JhZ2UuanMiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJleHBvcnRzIiwicmVxdWlyZSIsIm1vZHVsZSIsImRlZmluZSIsImFtZCIsIkJhY2tib25lIiwidGhpcyIsIlM0IiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyaW5nIiwiZ3VpZCIsImlzT2JqZWN0IiwiaXRlbSIsIk9iamVjdCIsImNvbnRhaW5zIiwiYXJyYXkiLCJpIiwibGVuZ3RoIiwiZXh0ZW5kIiwib2JqIiwicHJvcHMiLCJrZXkiLCJyZXN1bHQiLCJvYmplY3QiLCJwcm9wZXJ0eSIsInZhbHVlIiwiTG9jYWxTdG9yYWdlIiwid2luZG93IiwiU3RvcmUiLCJuYW1lIiwic2VyaWFsaXplciIsImxvY2FsU3RvcmFnZSIsInNlcmlhbGl6ZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJkZXNlcmlhbGl6ZSIsImRhdGEiLCJwYXJzZSIsInN0b3JlIiwiZ2V0SXRlbSIsInJlY29yZHMiLCJzcGxpdCIsInByb3RvdHlwZSIsInNhdmUiLCJzZXRJdGVtIiwiam9pbiIsImNyZWF0ZSIsIm1vZGVsIiwiaWQiLCJzZXQiLCJpZEF0dHJpYnV0ZSIsIl9pdGVtTmFtZSIsInB1c2giLCJmaW5kIiwidXBkYXRlIiwibW9kZWxJZCIsImZpbmRBbGwiLCJkZXN0cm95IiwicmVtb3ZlSXRlbSIsInNwbGljZSIsIl9jbGVhciIsImxvY2FsIiwiaXRlbVJlIiwiUmVnRXhwIiwiayIsInRlc3QiLCJfc3RvcmFnZVNpemUiLCJzeW5jIiwibG9jYWxTeW5jIiwibWV0aG9kIiwib3B0aW9ucyIsInJlc3AiLCJlcnJvck1lc3NhZ2UiLCJjb2xsZWN0aW9uIiwic3luY0RmZCIsIiQiLCJEZWZlcnJlZCIsInVuZGVmaW5lZCIsImVycm9yIiwiY29kZSIsIm1lc3NhZ2UiLCJzdWNjZXNzIiwiVkVSU0lPTiIsInJlc29sdmUiLCJyZWplY3QiLCJjb21wbGV0ZSIsInByb21p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QUFTb0IsTUFBTXRGLE1BQU9pRSxFQUFRdEIsRUFBT3VCLEtBR3JFbkUsRUFBU3VCIiwiZmlsZSI6ImxpYi9iYWNrYm9uZS5sb2NhbFN0b3JhZ2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEJhY2tib25lIGxvY2FsU3RvcmFnZSBBZGFwdGVyXG4gKiBWZXJzaW9uIDEuMS4xNlxuICpcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9qZXJvbWVnbi9CYWNrYm9uZS5sb2NhbFN0b3JhZ2VcbiAqL1xuKGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7XG4gIGlmICh0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIHJlcXVpcmUgPT09ICdmdW5jdGlvbicpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkocmVxdWlyZShcImJhY2tib25lXCIpKTtcbiAgfSBlbHNlIGlmICh0eXBlb2YgZGVmaW5lID09PSBcImZ1bmN0aW9uXCIgJiYgZGVmaW5lLmFtZCkge1xuICAgIC8vIEFNRC4gUmVnaXN0ZXIgYXMgYW4gYW5vbnltb3VzIG1vZHVsZS5cbiAgICBkZWZpbmUoW1wiYmFja2JvbmVcIl0sIGZ1bmN0aW9uKEJhY2tib25lKSB7XG4gICAgICAvLyBVc2UgZ2xvYmFsIHZhcmlhYmxlcyBpZiB0aGUgbG9jYWxzIGFyZSB1bmRlZmluZWQuXG4gICAgICByZXR1cm4gZmFjdG9yeShCYWNrYm9uZSB8fCByb290LkJhY2tib25lKTtcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICBmYWN0b3J5KEJhY2tib25lKTtcbiAgfVxufSh0aGlzLCBmdW5jdGlvbihCYWNrYm9uZSkge1xuLy8gQSBzaW1wbGUgbW9kdWxlIHRvIHJlcGxhY2UgYEJhY2tib25lLnN5bmNgIHdpdGggKmxvY2FsU3RvcmFnZSotYmFzZWRcbi8vIHBlcnNpc3RlbmNlLiBNb2RlbHMgYXJlIGdpdmVuIEdVSURTLCBhbmQgc2F2ZWQgaW50byBhIEpTT04gb2JqZWN0LiBTaW1wbGVcbi8vIGFzIHRoYXQuXG5cbi8vIEdlbmVyYXRlIGZvdXIgcmFuZG9tIGhleCBkaWdpdHMuXG5mdW5jdGlvbiBTNCgpIHtcbiAgIHJldHVybiAoKCgxK01hdGgucmFuZG9tKCkpKjB4MTAwMDApfDApLnRvU3RyaW5nKDE2KS5zdWJzdHJpbmcoMSk7XG59O1xuXG4vLyBHZW5lcmF0ZSBhIHBzZXVkby1HVUlEIGJ5IGNvbmNhdGVuYXRpbmcgcmFuZG9tIGhleGFkZWNpbWFsLlxuZnVuY3Rpb24gZ3VpZCgpIHtcbiAgIHJldHVybiAoUzQoKStTNCgpK1wiLVwiK1M0KCkrXCItXCIrUzQoKStcIi1cIitTNCgpK1wiLVwiK1M0KCkrUzQoKStTNCgpKTtcbn07XG5cbmZ1bmN0aW9uIGlzT2JqZWN0KGl0ZW0pIHtcbiAgcmV0dXJuIGl0ZW0gPT09IE9iamVjdChpdGVtKTtcbn1cblxuZnVuY3Rpb24gY29udGFpbnMoYXJyYXksIGl0ZW0pIHtcbiAgdmFyIGkgPSBhcnJheS5sZW5ndGg7XG4gIHdoaWxlIChpLS0pIGlmIChhcnJheVtpXSA9PT0gaXRlbSkgcmV0dXJuIHRydWU7XG4gIHJldHVybiBmYWxzZTtcbn1cblxuZnVuY3Rpb24gZXh0ZW5kKG9iaiwgcHJvcHMpIHtcbiAgZm9yICh2YXIga2V5IGluIHByb3BzKSBvYmpba2V5XSA9IHByb3BzW2tleV1cbiAgcmV0dXJuIG9iajtcbn1cblxuZnVuY3Rpb24gcmVzdWx0KG9iamVjdCwgcHJvcGVydHkpIHtcbiAgICBpZiAob2JqZWN0ID09IG51bGwpIHJldHVybiB2b2lkIDA7XG4gICAgdmFyIHZhbHVlID0gb2JqZWN0W3Byb3BlcnR5XTtcbiAgICByZXR1cm4gKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykgPyBvYmplY3RbcHJvcGVydHldKCkgOiB2YWx1ZTtcbn1cblxuLy8gT3VyIFN0b3JlIGlzIHJlcHJlc2VudGVkIGJ5IGEgc2luZ2xlIEpTIG9iamVjdCBpbiAqbG9jYWxTdG9yYWdlKi4gQ3JlYXRlIGl0XG4vLyB3aXRoIGEgbWVhbmluZ2Z1bCBuYW1lLCBsaWtlIHRoZSBuYW1lIHlvdSdkIGdpdmUgYSB0YWJsZS5cbi8vIHdpbmRvdy5TdG9yZSBpcyBkZXByZWN0YXRlZCwgdXNlIEJhY2tib25lLkxvY2FsU3RvcmFnZSBpbnN0ZWFkXG5CYWNrYm9uZS5Mb2NhbFN0b3JhZ2UgPSB3aW5kb3cuU3RvcmUgPSBmdW5jdGlvbihuYW1lLCBzZXJpYWxpemVyKSB7XG4gIGlmKCAhdGhpcy5sb2NhbFN0b3JhZ2UgKSB7XG4gICAgdGhyb3cgXCJCYWNrYm9uZS5sb2NhbFN0b3JhZ2U6IEVudmlyb25tZW50IGRvZXMgbm90IHN1cHBvcnQgbG9jYWxTdG9yYWdlLlwiXG4gIH1cbiAgdGhpcy5uYW1lID0gbmFtZTtcbiAgdGhpcy5zZXJpYWxpemVyID0gc2VyaWFsaXplciB8fCB7XG4gICAgc2VyaWFsaXplOiBmdW5jdGlvbihpdGVtKSB7XG4gICAgICByZXR1cm4gaXNPYmplY3QoaXRlbSkgPyBKU09OLnN0cmluZ2lmeShpdGVtKSA6IGl0ZW07XG4gICAgfSxcbiAgICAvLyBmaXggZm9yIFwiaWxsZWdhbCBhY2Nlc3NcIiBlcnJvciBvbiBBbmRyb2lkIHdoZW4gSlNPTi5wYXJzZSBpcyBwYXNzZWQgbnVsbFxuICAgIGRlc2VyaWFsaXplOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgcmV0dXJuIGRhdGEgJiYgSlNPTi5wYXJzZShkYXRhKTtcbiAgICB9XG4gIH07XG4gIHZhciBzdG9yZSA9IHRoaXMubG9jYWxTdG9yYWdlKCkuZ2V0SXRlbSh0aGlzLm5hbWUpO1xuICB0aGlzLnJlY29yZHMgPSAoc3RvcmUgJiYgc3RvcmUuc3BsaXQoXCIsXCIpKSB8fCBbXTtcbn07XG5cbmV4dGVuZChCYWNrYm9uZS5Mb2NhbFN0b3JhZ2UucHJvdG90eXBlLCB7XG5cbiAgLy8gU2F2ZSB0aGUgY3VycmVudCBzdGF0ZSBvZiB0aGUgKipTdG9yZSoqIHRvICpsb2NhbFN0b3JhZ2UqLlxuICBzYXZlOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmxvY2FsU3RvcmFnZSgpLnNldEl0ZW0odGhpcy5uYW1lLCB0aGlzLnJlY29yZHMuam9pbihcIixcIikpO1xuICB9LFxuXG4gIC8vIEFkZCBhIG1vZGVsLCBnaXZpbmcgaXQgYSAoaG9wZWZ1bGx5KS11bmlxdWUgR1VJRCwgaWYgaXQgZG9lc24ndCBhbHJlYWR5XG4gIC8vIGhhdmUgYW4gaWQgb2YgaXQncyBvd24uXG4gIGNyZWF0ZTogZnVuY3Rpb24obW9kZWwpIHtcbiAgICBpZiAoIW1vZGVsLmlkICYmIG1vZGVsLmlkICE9PSAwKSB7XG4gICAgICBtb2RlbC5pZCA9IGd1aWQoKTtcbiAgICAgIG1vZGVsLnNldChtb2RlbC5pZEF0dHJpYnV0ZSwgbW9kZWwuaWQpO1xuICAgIH1cbiAgICB0aGlzLmxvY2FsU3RvcmFnZSgpLnNldEl0ZW0odGhpcy5faXRlbU5hbWUobW9kZWwuaWQpLCB0aGlzLnNlcmlhbGl6ZXIuc2VyaWFsaXplKG1vZGVsKSk7XG4gICAgdGhpcy5yZWNvcmRzLnB1c2gobW9kZWwuaWQudG9TdHJpbmcoKSk7XG4gICAgdGhpcy5zYXZlKCk7XG4gICAgcmV0dXJuIHRoaXMuZmluZChtb2RlbCk7XG4gIH0sXG5cbiAgLy8gVXBkYXRlIGEgbW9kZWwgYnkgcmVwbGFjaW5nIGl0cyBjb3B5IGluIGB0aGlzLmRhdGFgLlxuICB1cGRhdGU6IGZ1bmN0aW9uKG1vZGVsKSB7XG4gICAgdGhpcy5sb2NhbFN0b3JhZ2UoKS5zZXRJdGVtKHRoaXMuX2l0ZW1OYW1lKG1vZGVsLmlkKSwgdGhpcy5zZXJpYWxpemVyLnNlcmlhbGl6ZShtb2RlbCkpO1xuICAgIHZhciBtb2RlbElkID0gbW9kZWwuaWQudG9TdHJpbmcoKTtcbiAgICBpZiAoIWNvbnRhaW5zKHRoaXMucmVjb3JkcywgbW9kZWxJZCkpIHtcbiAgICAgIHRoaXMucmVjb3Jkcy5wdXNoKG1vZGVsSWQpO1xuICAgICAgdGhpcy5zYXZlKCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmZpbmQobW9kZWwpO1xuICB9LFxuXG4gIC8vIFJldHJpZXZlIGEgbW9kZWwgZnJvbSBgdGhpcy5kYXRhYCBieSBpZC5cbiAgZmluZDogZnVuY3Rpb24obW9kZWwpIHtcbiAgICByZXR1cm4gdGhpcy5zZXJpYWxpemVyLmRlc2VyaWFsaXplKHRoaXMubG9jYWxTdG9yYWdlKCkuZ2V0SXRlbSh0aGlzLl9pdGVtTmFtZShtb2RlbC5pZCkpKTtcbiAgfSxcblxuICAvLyBSZXR1cm4gdGhlIGFycmF5IG9mIGFsbCBtb2RlbHMgY3VycmVudGx5IGluIHN0b3JhZ2UuXG4gIGZpbmRBbGw6IGZ1bmN0aW9uKCkge1xuICAgIHZhciByZXN1bHQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMCwgaWQsIGRhdGE7IGkgPCB0aGlzLnJlY29yZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlkID0gdGhpcy5yZWNvcmRzW2ldO1xuICAgICAgZGF0YSA9IHRoaXMuc2VyaWFsaXplci5kZXNlcmlhbGl6ZSh0aGlzLmxvY2FsU3RvcmFnZSgpLmdldEl0ZW0odGhpcy5faXRlbU5hbWUoaWQpKSk7XG4gICAgICBpZiAoZGF0YSAhPSBudWxsKSByZXN1bHQucHVzaChkYXRhKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfSxcblxuICAvLyBEZWxldGUgYSBtb2RlbCBmcm9tIGB0aGlzLmRhdGFgLCByZXR1cm5pbmcgaXQuXG4gIGRlc3Ryb3k6IGZ1bmN0aW9uKG1vZGVsKSB7XG4gICAgdGhpcy5sb2NhbFN0b3JhZ2UoKS5yZW1vdmVJdGVtKHRoaXMuX2l0ZW1OYW1lKG1vZGVsLmlkKSk7XG4gICAgdmFyIG1vZGVsSWQgPSBtb2RlbC5pZC50b1N0cmluZygpO1xuICAgIGZvciAodmFyIGkgPSAwLCBpZDsgaSA8IHRoaXMucmVjb3Jkcy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKHRoaXMucmVjb3Jkc1tpXSA9PT0gbW9kZWxJZCkge1xuICAgICAgICB0aGlzLnJlY29yZHMuc3BsaWNlKGksIDEpO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLnNhdmUoKTtcbiAgICByZXR1cm4gbW9kZWw7XG4gIH0sXG5cbiAgbG9jYWxTdG9yYWdlOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbG9jYWxTdG9yYWdlO1xuICB9LFxuXG4gIC8vIENsZWFyIGxvY2FsU3RvcmFnZSBmb3Igc3BlY2lmaWMgY29sbGVjdGlvbi5cbiAgX2NsZWFyOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgbG9jYWwgPSB0aGlzLmxvY2FsU3RvcmFnZSgpLFxuICAgICAgaXRlbVJlID0gbmV3IFJlZ0V4cChcIl5cIiArIHRoaXMubmFtZSArIFwiLVwiKTtcblxuICAgIC8vIFJlbW92ZSBpZC10cmFja2luZyBpdGVtIChlLmcuLCBcImZvb1wiKS5cbiAgICBsb2NhbC5yZW1vdmVJdGVtKHRoaXMubmFtZSk7XG5cbiAgICAvLyBNYXRjaCBhbGwgZGF0YSBpdGVtcyAoZS5nLiwgXCJmb28tSURcIikgYW5kIHJlbW92ZS5cbiAgICBmb3IgKHZhciBrIGluIGxvY2FsKSB7XG4gICAgICBpZiAoaXRlbVJlLnRlc3QoaykpIHtcbiAgICAgICAgbG9jYWwucmVtb3ZlSXRlbShrKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLnJlY29yZHMubGVuZ3RoID0gMDtcbiAgfSxcblxuICAvLyBTaXplIG9mIGxvY2FsU3RvcmFnZS5cbiAgX3N0b3JhZ2VTaXplOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5sb2NhbFN0b3JhZ2UoKS5sZW5ndGg7XG4gIH0sXG5cbiAgX2l0ZW1OYW1lOiBmdW5jdGlvbihpZCkge1xuICAgIHJldHVybiB0aGlzLm5hbWUrXCItXCIraWQ7XG4gIH1cblxufSk7XG5cbi8vIGxvY2FsU3luYyBkZWxlZ2F0ZSB0byB0aGUgbW9kZWwgb3IgY29sbGVjdGlvbidzXG4vLyAqbG9jYWxTdG9yYWdlKiBwcm9wZXJ0eSwgd2hpY2ggc2hvdWxkIGJlIGFuIGluc3RhbmNlIG9mIGBTdG9yZWAuXG4vLyB3aW5kb3cuU3RvcmUuc3luYyBhbmQgQmFja2JvbmUubG9jYWxTeW5jIGlzIGRlcHJlY2F0ZWQsIHVzZSBCYWNrYm9uZS5Mb2NhbFN0b3JhZ2Uuc3luYyBpbnN0ZWFkXG5CYWNrYm9uZS5Mb2NhbFN0b3JhZ2Uuc3luYyA9IHdpbmRvdy5TdG9yZS5zeW5jID0gQmFja2JvbmUubG9jYWxTeW5jID0gZnVuY3Rpb24obWV0aG9kLCBtb2RlbCwgb3B0aW9ucykge1xuICB2YXIgc3RvcmUgPSByZXN1bHQobW9kZWwsICdsb2NhbFN0b3JhZ2UnKSB8fCByZXN1bHQobW9kZWwuY29sbGVjdGlvbiwgJ2xvY2FsU3RvcmFnZScpO1xuXG4gIHZhciByZXNwLCBlcnJvck1lc3NhZ2U7XG4gIC8vSWYgJCBpcyBoYXZpbmcgRGVmZXJyZWQgLSB1c2UgaXQuXG4gIHZhciBzeW5jRGZkID0gQmFja2JvbmUuJCA/XG4gICAgKEJhY2tib25lLiQuRGVmZXJyZWQgJiYgQmFja2JvbmUuJC5EZWZlcnJlZCgpKSA6XG4gICAgKEJhY2tib25lLkRlZmVycmVkICYmIEJhY2tib25lLkRlZmVycmVkKCkpO1xuXG4gIHRyeSB7XG5cbiAgICBzd2l0Y2ggKG1ldGhvZCkge1xuICAgICAgY2FzZSBcInJlYWRcIjpcbiAgICAgICAgcmVzcCA9IG1vZGVsLmlkICE9IHVuZGVmaW5lZCA/IHN0b3JlLmZpbmQobW9kZWwpIDogc3RvcmUuZmluZEFsbCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJjcmVhdGVcIjpcbiAgICAgICAgcmVzcCA9IHN0b3JlLmNyZWF0ZShtb2RlbCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcInVwZGF0ZVwiOlxuICAgICAgICByZXNwID0gc3RvcmUudXBkYXRlKG1vZGVsKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiZGVsZXRlXCI6XG4gICAgICAgIHJlc3AgPSBzdG9yZS5kZXN0cm95KG1vZGVsKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gIH0gY2F0Y2goZXJyb3IpIHtcbiAgICBpZiAoZXJyb3IuY29kZSA9PT0gMjIgJiYgc3RvcmUuX3N0b3JhZ2VTaXplKCkgPT09IDApXG4gICAgICBlcnJvck1lc3NhZ2UgPSBcIlByaXZhdGUgYnJvd3NpbmcgaXMgdW5zdXBwb3J0ZWRcIjtcbiAgICBlbHNlXG4gICAgICBlcnJvck1lc3NhZ2UgPSBlcnJvci5tZXNzYWdlO1xuICB9XG5cbiAgaWYgKHJlc3ApIHtcbiAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnN1Y2Nlc3MpIHtcbiAgICAgIGlmIChCYWNrYm9uZS5WRVJTSU9OID09PSBcIjAuOS4xMFwiKSB7XG4gICAgICAgIG9wdGlvbnMuc3VjY2Vzcyhtb2RlbCwgcmVzcCwgb3B0aW9ucyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvcHRpb25zLnN1Y2Nlc3MocmVzcCk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChzeW5jRGZkKSB7XG4gICAgICBzeW5jRGZkLnJlc29sdmUocmVzcCk7XG4gICAgfVxuXG4gIH0gZWxzZSB7XG4gICAgZXJyb3JNZXNzYWdlID0gZXJyb3JNZXNzYWdlID8gZXJyb3JNZXNzYWdlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogXCJSZWNvcmQgTm90IEZvdW5kXCI7XG5cbiAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmVycm9yKVxuICAgICAgaWYgKEJhY2tib25lLlZFUlNJT04gPT09IFwiMC45LjEwXCIpIHtcbiAgICAgICAgb3B0aW9ucy5lcnJvcihtb2RlbCwgZXJyb3JNZXNzYWdlLCBvcHRpb25zKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG9wdGlvbnMuZXJyb3IoZXJyb3JNZXNzYWdlKTtcbiAgICAgIH1cblxuICAgIGlmIChzeW5jRGZkKVxuICAgICAgc3luY0RmZC5yZWplY3QoZXJyb3JNZXNzYWdlKTtcbiAgfVxuXG4gIC8vIGFkZCBjb21wYXRpYmlsaXR5IHdpdGggJC5hamF4XG4gIC8vIGFsd2F5cyBleGVjdXRlIGNhbGxiYWNrIGZvciBzdWNjZXNzIGFuZCBlcnJvclxuICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmNvbXBsZXRlKSBvcHRpb25zLmNvbXBsZXRlKHJlc3ApO1xuXG4gIHJldHVybiBzeW5jRGZkICYmIHN5bmNEZmQucHJvbWlzZSgpO1xufTtcblxuQmFja2JvbmUuYWpheFN5bmMgPSBCYWNrYm9uZS5zeW5jO1xuXG5CYWNrYm9uZS5nZXRTeW5jTWV0aG9kID0gZnVuY3Rpb24obW9kZWwsIG9wdGlvbnMpIHtcbiAgdmFyIGZvcmNlQWpheFN5bmMgPSBvcHRpb25zICYmIG9wdGlvbnMuYWpheFN5bmM7XG5cbiAgaWYoIWZvcmNlQWpheFN5bmMgJiYgKHJlc3VsdChtb2RlbCwgJ2xvY2FsU3RvcmFnZScpIHx8IHJlc3VsdChtb2RlbC5jb2xsZWN0aW9uLCAnbG9jYWxTdG9yYWdlJykpKSB7XG4gICAgcmV0dXJuIEJhY2tib25lLmxvY2FsU3luYztcbiAgfVxuXG4gIHJldHVybiBCYWNrYm9uZS5hamF4U3luYztcbn07XG5cbi8vIE92ZXJyaWRlICdCYWNrYm9uZS5zeW5jJyB0byBkZWZhdWx0IHRvIGxvY2FsU3luYyxcbi8vIHRoZSBvcmlnaW5hbCAnQmFja2JvbmUuc3luYycgaXMgc3RpbGwgYXZhaWxhYmxlIGluICdCYWNrYm9uZS5hamF4U3luYydcbkJhY2tib25lLnN5bmMgPSBmdW5jdGlvbihtZXRob2QsIG1vZGVsLCBvcHRpb25zKSB7XG4gIHJldHVybiBCYWNrYm9uZS5nZXRTeW5jTWV0aG9kKG1vZGVsLCBvcHRpb25zKS5hcHBseSh0aGlzLCBbbWV0aG9kLCBtb2RlbCwgb3B0aW9uc10pO1xufTtcblxucmV0dXJuIEJhY2tib25lLkxvY2FsU3RvcmFnZTtcbn0pKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
